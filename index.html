<script type="text/javascript" src="libs/papaparse/papaparse.min.js"></script>
<script type="text/javascript" src="ddfcsv.js"></script>
<script type="text/javascript">

	let ddfcsv = Object.create(ddfcsvReader);
	ddfcsv.loadDataset("data/ddf--pcbs--census-master/datapackage.json")
		.then(performQuery)
		.then(console.log);

	function performQuery() {
	
		const queries = [{
			select: {
				key: ["geo"],
				value: ["name","region","is--region","is--country"]
			},
			from: "entities",
			where: {
				$or: [
				{region: "1" },
				{region: "2" }
				]
			}
		},{
			select: {
				key: ["governorate", "year"],
				value: ["buildings"]
			},
			from: "datapoints",
			where: {
				"governorate": { $in: ["1101","1105","1110","1120","1125"] },
				$or: [
					{"buildings": { $lte: 32833 }},
					{"buildings": { $gte: 50000 }}
				]
			}
		}];

		document.addEventListener('readystatechange', ready);
		function ready() {
			if (document.readyState != 'loading') {
				document.getElementById("query").innerHTML = JSON.stringify(query, null, 2);
			}
		}
		ready();
		console.log(JSON.stringify(queries,null,2));
		return Promise.all(queries.map(ddfcsv.performQuery.bind(ddfcsv)));
	}

</script>
<body>
<pre id="query">
</pre>
</body>